CREATE TABLE IF NOT EXISTS `servicios` ( `id_servicio` bigint(20) NOT NULL auto_increment, `nombre` tinytext NOT NULL, `descripcion` text NULL, `fecha_alta` date NOT NULL,  `fecha_baja` date NULL,  `precio_base` decimal(20,3) NOT NULL,  `periodo` int NOT NULL,  `dia_cobro` int NOT NULL,  `forma_incompleto` int NOT NULL,  `texto_facturacion` TEXT NULL,PRIMARY KEY  (`id_servicio`) ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;
CREATE TABLE IF NOT EXISTS `servicios_clientes` ( `id_servicio` bigint(20) REFERENCES servicios(id_servicio), `id_cliente` bigint(20) REFERENCES clientes(id), `fecha_alta` DATETIME NOT NULL, `fecha_baja` DATETIME NULL, `razon` TINYTEXT NULL, PRIMARY KEY  (`id_servicio`, `id_cliente` )) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;
CREATE TABLE IF NOT EXISTS `recargos` ( `id_recargo` bigint(20) NOT NULL AUTO_INCREMENT, `id_servicio` bigint(20) NOT NULL,  `cant_dias` int NOT NULL,  `porcentaje` decimal(20,8) DEFAULT NULL,  `recargo` decimal(20,3) DEFAULT NULL,  PRIMARY KEY (`id_recargo`) ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;
CREATE TABLE IF NOT EXISTS `periodo_servicio` ( `id_periodo_servicio` bigint(20) NOT NULL AUTO_INCREMENT, `id_servicio` bigint(20) NOT NULL, `fecha` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, `periodo` INT NOT NULL, `ano` YEAR NOT NULL, `fecha_inicio` DATE NOT NULL, `fecha_fin` DATE NOT NULL,  FOREIGN KEY ( `id_servicio` ) REFERENCES `servicios`( `id_servicio` ), PRIMARY KEY ( `id_periodo_servicio` )) ENGINE = InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;
CREATE TABLE IF NOT EXISTS `cobro_servicio_cliente_periodo` ( `id_periodo_servicio` bigint(20) NOT NULL, `id_servicio` bigint(20) NOT NULL, `id_cliente` bigint(20) NOT NULL, `id_factura` bigint(20) NOT NULL, `id_recibo` bigint(20) DEFAULT NULL, `id_ctacte` BIGINT DEFAULT NULL, FOREIGN KEY ( id_periodo_servicio ) REFERENCES `periodo_servicio`( id_periodo_servicio ), FOREIGN KEY ( id_servicio, id_cliente ) REFERENCES `servicios_clientes`( id_servicio, id_cliente ), FOREIGN KEY ( id_ctacte ) REFERENCES `item_ctacte`(id_op_ctacte), FOREIGN KEY ( id_recibo ) REFERENCES `recibos`( id_recibo ), PRIMARY KEY ( id_periodo_servicio, id_servicio, id_cliente )) ENGINE = InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;
CREATE TABLE IF NOT EXISTS `recargo_cobro_servicio_cliente` (  `id_periodo_servicio` bigint(20) NOT NULL, `id_servicio` bigint(20) NOT NULL, `id_cliente` bigint(20) NOT NULL, `id_recargo` bigint(20) NOT NULL, `fecha_generado` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,  `texto_detalle` TEXT NOT NULL, `precio` decimal(20,3) NOT NULL,  `id_ctacte` bigint(20) NOT NULL, `id_recibo` bigint(20), FOREIGN KEY ( id_periodo_servicio, id_servicio, id_cliente ) REFERENCES `cobro_servicio_cliente_periodo`( id_periodo_servicio, id_servicio, id_cliente ), FOREIGN KEY ( id_recargo ) REFERENCES `recargos`( id_recargo ), FOREIGN KEY ( id_ctacte ) REFERENCES `item_ctacte`( id_op_ctacte ), FOREIGN KEY ( id_recibo ) REFERENCES `recibos`( id_recibo ), PRIMARY KEY ( id_periodo_servicio, id_servicio, id_cliente, id_recargo ) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish_ci;
CREATE VIEW IF NOT EXISTS "v_servicios_clientes" AS   SELECT id_servicio, id_cliente, fecha_alta, fecha_baja, razon, id_servicio AS idservicio, id_cliente AS idcliente FROM servicios_clientes;